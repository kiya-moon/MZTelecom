<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:fragment="headerFragment">
	<header class="header">
		<div class="header-content">
			<div class="logo">
				<a th:href="@{/}">
					<img th:src="@{/images/MZ_logo.png}" alt="Logo">
				</a>
			</div>

			<div class="menu">
				<ul class="menu-list">
					<li><a th:href="@{/product.do}">모바일기기</a></li>
					<li><a th:href="@{/phoneplan.do}">모바일 요금제</a></li>
					<li><a th:href="@{/support.do}">고객지원</a></li>
					<li><a th:href="@{/purRevBoard.do}">구매후기</a></li>
				</ul>
			</div>

			<div class="icons">
				<a th:attr="href=${null}" class="search">
					<input name="keyword" type="text" oninput="performSearch(this.value)"/>
					<i data-feather="search"></i>
					
					<div id="searchResults" class="search-results"></div>
				</a>
				
				<a th:href="@{/cart}">
					<i data-feather="shopping-cart"></i>
				</a>
				<a th:href="@{/login}">
					<i data-feather="user"></i>
				</a>
				<div class="hamburger-menu">
					<a th:attr="href=${null}" onclick="toggleMenu()">
						<i data-feather="menu"></i>
					</a>
				</div>
			</div>
			

			<!-- 모바일용 메뉴 -->
			<div class="mobile-menu">
				<div class="mobile-icons">
					<div class="mobile-user">
						<a th:href="@{/cart}">
							<i data-feather="shopping-cart"></i>
						</a>
						<a th:href="@{/login}">
							<i data-feather="user"></i>
						</a>
					</div>
					<div class="mobile-menu-close" onclick="closeMenu()">
						<i data-feather="x"></i>
					</div>
				</div>
				<ul class="menu-list">
					<li><a th:href="@{/product}">모바일기기</a></li>
					<li><a th:href="@{/phoneplan}">모바일 요금제</a></li>
					<li><a th:href="@{/support}">고객지원</a></li>
					<li><a th:href="@{/purRevBoard}">구매후기</a></li>
				</ul>
			</div>
		</div>
	</header>

	<script>
	    const searchResultsEl = document.getElementById('searchResults');
	
	    function performSearch(keyword) {
	        const searchEl = document.querySelector('.search');
	        const searchInputEl = searchEl.querySelector('input');
	        
	        // 제품 검색 API 호출 및 검색어에 따른 결과 가져오기
	        fetch(`/search.do?keyword=${keyword}`)
	            .then(response => response.json())
	            .then(products => {
	                // 검색 결과를 보여줄 HTML 생성
	                let resultsHTML = '<ul>';
	                products.forEach(product => {
	                    resultsHTML += `<li>${product.intmNm}</li>`;
	                });
	                resultsHTML += '</ul>';
	
	                // 검색 결과를 searchResultsEl에 업데이트하고 보여주기
	                searchResultsEl.innerHTML = resultsHTML;
	                searchResultsEl.style.display = 'block';
	            })
	            .catch(error => {
	                console.error('Error fetching search results:', error);
	                searchResultsEl.innerHTML = '검색 결과를 불러오는 중 오류가 발생했습니다.';
	                searchResultsEl.style.display = 'block';
	            });
	    }
	
	    document.addEventListener('click', function(e) {
	        const searchEl = document.querySelector('.search');
	        const searchInputEl = searchEl.querySelector('input');
	
	        if (!searchEl.contains(e.target)) {
	            searchEl.classList.remove('focused');
	            searchInputEl.setAttribute('placeholder', '');
	            searchResultsEl.style.display = 'none';
	        } else {
	            searchEl.classList.add('focused');
	            searchInputEl.setAttribute('placeholder', '통합검색');
	        }
	    });
	</script>
</th:block>

</html>